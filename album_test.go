package lastfm

import (
	"encoding/xml"
	"fmt"
	. "launchpad.net/gocheck"
)

func (s *S) TestBuyLinksUnmarshal(c *C) {
	respString := `<?xml version="1.0" encoding="utf-8"?>
<lfm status="ok"><affiliations><physicals><affiliation><supplierName>Amazon</supplierName><price><currency>GBP</currency><amount>6.10</amount><formatted>£6.10</formatted></price><buyLink>http://www.last.fm/affiliate/byid/8/3418994/1/ws.album.buylinks.d0a8c6b594b43669503d9f51aaabea22</buyLink><supplierIcon>http://cdn.last.fm/favicons/1/amazon.gif</supplierIcon><isSearch>0</isSearch></affiliation><affiliation><supplierName>eBay</supplierName><buyLink>http://www.last.fm/affiliate/byid/8/3418994/90/ws.album.buylinks.d0a8c6b594b43669503d9f51aaabea22</buyLink><supplierIcon>http://cdn.last.fm/favicons/ebay.gif</supplierIcon><isSearch>1</isSearch></affiliation></physicals><downloads><affiliation><supplierName>Amazon MP3</supplierName><price><currency>GBP</currency><amount>7.90</amount><formatted>£7.90</formatted></price><buyLink>http://www.last.fm/affiliate/byid/8/3418994/44/ws.album.buylinks.d0a8c6b594b43669503d9f51aaabea22</buyLink><supplierIcon>http://cdn.last.fm/favicons/amazon-mp3-16x16-a.gif</supplierIcon><isSearch>0</isSearch></affiliation><affiliation><supplierName>7digital</supplierName><price><currency>GBP</currency><amount>7.99</amount><formatted>£7.99</formatted></price><buyLink>http://www.last.fm/affiliate/byid/8/3418994/13/ws.album.buylinks.d0a8c6b594b43669503d9f51aaabea22</buyLink><supplierIcon>http://cdn.last.fm/favicons/7digital.gif</supplierIcon><isSearch>0</isSearch></affiliation><affiliation><supplierName>iTunes</supplierName><price><currency>GBP</currency><amount>7.99</amount><formatted>£7.99</formatted></price><buyLink>http://www.last.fm/affiliate/byid/8/3418994/24/ws.album.buylinks.d0a8c6b594b43669503d9f51aaabea22</buyLink><supplierIcon>http://cdn.last.fm/favicons/itunesbadge.gif</supplierIcon><isSearch>0</isSearch></affiliation></downloads></affiliations></lfm>`
	v := BuyLinks{}
	err := xml.Unmarshal([]byte(respString), &struct {
		Affiliations *BuyLinks `xml:"affiliations"`
	}{Affiliations: &v})
	c.Assert(err, IsNil)
	c.Assert(len(v.Physicals), Equals, 2)
	c.Assert(v.Physicals[0].SupplierName, Equals, "Amazon")
}

func (s *S) TestBuyLinksE2E(c *C) {
	buyLinks, err := testClient.Album().GetBuyLinks("Radiohead", "OK Computer", false, "GB")
	c.Assert(err, IsNil)
	c.Assert(buyLinks.Physicals, Not(HasLen), 0)
}

var _ = fmt.Println

func (s *S) TestGetInfoUnmarshal(c *C) {
	respString := `<?xml version="1.0" encoding="utf-8"?>
<lfm status="ok"><album><name>Believe</name><artist>Cher</artist><id>2026126</id><mbid>250e1aa0-fbb9-4f15-8321-3550b6c742ac</mbid><url>http://www.last.fm/music/Cher/Believe</url><releasedate>    5 Jul 2005, 00:00</releasedate><image size="small">http://userserve-ak.last.fm/serve/34s/72903330.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/72903330.png</image><image size="large">http://userserve-ak.last.fm/serve/174s/72903330.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/72903330.png</image><image size="mega">http://userserve-ak.last.fm/serve/_/72903330/Believe.png</image><listeners>205287</listeners><playcount>1067073</playcount><tracks><track rank="1"><name>Believe</name><duration>222</duration><mbid>028523f5-23b3-4910-adc1-46d932e2fb55</mbid><url>http://www.last.fm/music/Cher/_/Believe</url><streamable fulltrack="0">1</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="2"><name>The Power</name><duration>236</duration><mbid>173cf503-cc44-4291-ab91-2286aafe6efa</mbid><url>http://www.last.fm/music/Cher/_/The+Power</url><streamable fulltrack="0">0</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="3"><name>Runaway</name><duration>286</duration><mbid>379f760d-1f29-4317-ab04-06a8218a874d</mbid><url>http://www.last.fm/music/Cher/_/Runaway</url><streamable fulltrack="0">0</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="4"><name>All or Nothing</name><duration>237</duration><mbid>12e9720f-c14f-45f1-8c47-de8a3a08f4c0</mbid><url>http://www.last.fm/music/Cher/_/All+or+Nothing</url><streamable fulltrack="0">0</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="5"><name>Strong Enough</name><duration>223</duration><mbid>03bc1da8-3b25-4060-b843-1fbf60c046a8</mbid><url>http://www.last.fm/music/Cher/_/Strong+Enough</url><streamable fulltrack="0">1</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="6"><name>Dov'è L'amore</name><duration>258</duration><mbid>08d88e27-6245-4684-aada-c78a8eb996be</mbid><url>http://www.last.fm/music/Cher/_/Dov%27%C3%A8+L%27amore</url><streamable fulltrack="0">0</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="7"><name>Takin' Back My Heart</name><duration>272</duration><mbid>07a38e80-ba81-494a-a61a-e8d81a40413e</mbid><url>http://www.last.fm/music/Cher/_/Takin%27+Back+My+Heart</url><streamable fulltrack="0">0</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="8"><name>Taxi Taxi</name><duration>304</duration><mbid>66f526c9-b135-4458-86cf-77065ce8f0aa</mbid><url>http://www.last.fm/music/Cher/_/Taxi+Taxi</url><streamable fulltrack="0">0</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="9"><name>Love Is the Groove</name><duration>271</duration><mbid>832f8f9a-95e4-476b-b108-14dec1dc84ba</mbid><url>http://www.last.fm/music/Cher/_/Love+Is+the+Groove</url><streamable fulltrack="0">0</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track><track rank="10"><name>We All Sleep Alone</name><duration>233</duration><mbid>0188050c-401a-4633-a593-ba137390e9c4</mbid><url>http://www.last.fm/music/Cher/_/We+All+Sleep+Alone</url><streamable fulltrack="0">1</streamable><artist><name>Cher</name><mbid>bfcc6d75-a6a5-4bc6-8282-47aec8531818</mbid><url>http://www.last.fm/music/Cher</url></artist></track></tracks><toptags><tag><name>sourabh</name><url>http://www.last.fm/tag/sourabh</url></tag><tag><name>albums</name><url>http://www.last.fm/tag/albums</url></tag><tag><name>pop</name><url>http://www.last.fm/tag/pop</url></tag><tag><name>90s</name><url>http://www.last.fm/tag/90s</url></tag><tag><name>dance</name><url>http://www.last.fm/tag/dance</url></tag></toptags><wiki><published>Sat, 6 Mar 2010 16:48:03 +0000</published><summary><![CDATA[Believe is the twenty-third studio album by American  singer-actress Cher, released on November 10, 1998 by Warner Bros. Records. The RIAA certified it Quadruple Platinum on December 23, 1999, recognizing four million shipments in the United States; Worldwide, the album has sold more than 20 million copies, making it the biggest-selling album of her career. In 1999 the album received three Grammy Awards nominations including &quot;Record of the Year&quot;, &quot;Best Pop Album&quot; and winning &quot;Best Dance Recording&quot; for the single &quot;Believe&quot;. ]]></summary><content><![CDATA[REPLACED CONTENT]]></content></wiki></album></lfm>
`
	v := AlbumInfo{}
	err := xml.Unmarshal([]byte(respString), &struct {
		Album *AlbumInfo `xml:"album"`
	}{Album: &v})
	c.Assert(err, IsNil)
	c.Check(v.Name, Equals, "Believe")
	c.Check(v.Artist, Equals, "Cher")
	c.Check(v.Images, HasLen, 5)
	c.Check(v.Images[3].Url, Equals, "http://userserve-ak.last.fm/serve/300x300/72903330.png")
	c.Check(v.Tracks, HasLen, 10)
	c.Check(v.Tracks[2].Name, Equals, "Runaway")
}

func (s *S) TestGetInfoE2E(c *C) {
	albumInfo, err := testClient.Album().GetInfo("Radiohead", "OK Computer", false, "", "")
	c.Assert(err, IsNil)
	c.Assert(albumInfo.Name, Equals, "OK Computer")
	c.Assert(albumInfo.Tracks, HasLen, 12)
}

func (s *S) TestGetShoutsUnmarshal(c *C) {
	respString := `<?xml version="1.0" encoding="utf-8"?>
<lfm status="ok"><shouts artist="Cher" album="Believe" page="1" perPage="50" totalPages="1" total="36"><shout><body>♥ ♥ ♥</body><author>Sweetboy_88</author><date>Sun, 28 Oct 2012 19:30:33</date></shout><shout><body>COMEBACK DO SÉCULO! &lt;3</body><author>igorgeneration</author><date>Wed, 10 Oct 2012 00:45:03</date></shout><shout><body>Taxi Taxi &lt;3</body><author>digiroro</author><date>Sun, 16 Sep 2012 17:44:54</date></shout><shout><body>Your the best cher the one and only and u always will be i love your music !!!!!</body><author>chenoarose60</author><date>Tue, 26 Jun 2012 23:36:06</date></shout><shout><body>&lt;3</body><author>FreeMHZ</author><date>Fri, 23 Mar 2012 02:14:48</date></shout><shout><body>&lt;3</body><author>MisterBoombox</author><date>Sun, 26 Feb 2012 16:36:55</date></shout><shout><body>м м)</body><author>EricValeev</author><date>Mon, 26 Sep 2011 10:56:03</date></shout><shout><body>Still sounds fresh</body><author>lacerdathiago</author><date>Sat, 3 Sep 2011 12:45:55</date></shout><shout><body>We All Sleep Alone ♥</body><author>MisterBoombox</author><date>Sun, 28 Aug 2011 15:12:59</date></shout><shout><body>Believe &amp; Strong Enough ♥ OMG! perfect songs</body><author>JFERREIRA87</author><date>Fri, 24 Jun 2011 00:53:11</date></shout><shout><body>divina.</body><author>Cvilla69</author><date>Thu, 10 Feb 2011 19:39:12</date></shout><shout><body>yeah it really rocks [2]</body><author>top20fanatico</author><date>Wed, 15 Dec 2010 21:38:31</date></shout><shout><body>I remember this album from my childhood, it was on tape and was played 24/7 by my parents in home as well as in car :D all of us really loved it. and I still think it's very good although my music taste is very different now.</body><author>IrminkaT</author><date>Sat, 24 Jul 2010 17:37:07</date></shout><shout><body>one of the best pop albums.</body><author>gokhanesque</author><date>Mon, 5 Jul 2010 21:14:48</date></shout><shout><body>Believe ♥</body><author>marcio11</author><date>Sun, 13 Jun 2010 21:39:19</date></shout><shout><body>mi mucica preferedia</body><author>marina0179</author><date>Sun, 16 May 2010 01:22:12</date></shout><shout><body>Depois de tantos anos de carreira, é desnecessário dizer que o que quer que a diva Cher faça, ela o fará bem. Desde do pop otimista da dupla com Sony, passando por rainha das pistas da disco no final dos setenta, até o seu lado hard rock produzidos e compostos por Bon Jovi e Desmond Child. O single hit “Believe” chegou fuzilando as rádios com seus efeitos vocais futurísticos que são usados até os dias de hoje sem nenhuma timidez. O ábum ainda conta com o mega sucesso “Strong Enough” super dançante com cara de Barry White do futuro. Sua voz totalmente diferente continua a surpreender qualquer amador desconfiado e está muito bem encaixada nessa nova jornada dance de sua carreira. “The Power”, “Takin’ Back My Heart”  e “Runaway” poderiam ter se tornados grandes sucessos também, mas ainda empolgam os fãs desse trabalho. O álbum ainda conta com a boa versão dance de “We All Sleep Alone” de seu álbum “Cher” de 87.</body><author>ClaudioGurgel</author><date>Tue, 23 Mar 2010 20:02:54</date></shout><shout><body>I Love Strong Enough</body><author>rofeki</author><date>Sat, 13 Mar 2010 02:51:27</date></shout><shout><body>Strong enough .. gotta love it :)</body><author>Tracelace</author><date>Fri, 12 Mar 2010 21:52:41</date></shout><shout><body>Strong Enough&lt;3</body><author>blackout_rem</author><date>Fri, 6 Nov 2009 19:27:04</date></shout><shout><body>Runaway, Taxi Taxi, All or nothing &lt;3&lt;3&lt;3</body><author>arch_enemy_1987</author><date>Tue, 15 Sep 2009 19:13:27</date></shout><shout><body>Me encanta la voz de esta mujer.
Y como actriz también me gusta.
Beleve es espectacular.....
</body><author>PELIRROJAROJA</author><date>Fri, 16 Jan 2009 02:23:04</date></shout><shout><body>believe album is not bad but not.com.mercial,livin' proof,it's a man's world,stars,i'd rather believe in you,prisoner,cher,heart of stone,love hurts albums are better :D hihi what else :D</body><author>CherFanGay</author><date>Fri, 21 Nov 2008 09:57:19</date></shout><shout><body>yeah it really rocks</body><author>blond-ambition</author><date>Thu, 18 Sep 2008 17:11:37</date></shout><shout><body>i love taxi taxi:)</body><author>CherFanGay</author><date>Tue, 29 Jan 2008 13:59:32</date></shout><shout><body>did cher die?</body><author>rgurney</author><date>Mon, 16 Jul 2007 05:04:56</date></shout><shout><body>I love Taxi Taxi so much!!x</body><author>Maxes</author><date>Sat, 26 May 2007 23:53:57</date></shout><shout><body>Her face creeps me out. But I love her music. </body><author>TMNWY</author><date>Sun, 20 May 2007 21:24:52</date></shout><shout><body>strong voice,great vocalist as if u need telling.kaz07</body><author>kaz07</author><date>Mon, 30 Apr 2007 02:17:31</date></shout><shout><body>No comments for Believe? Nice album, but Living Proof is better ;&gt;</body><author>IParalyze</author><date>Tue, 30 Jan 2007 14:21:10</date></shout></shouts></lfm>`
	shouts := []Shout{}
	err := xml.Unmarshal([]byte(respString), &struct {
		Shouts *[]Shout `xml:"shouts>shout"`
	}{Shouts: &shouts})
	c.Assert(err, IsNil)
	c.Check(shouts, HasLen, 30)
}

func (s *S) TestGetShoutsE2E(c *C) {
	shouts, err := testClient.Album().GetShouts("Radiohead", "OK Computer", false, 1)
	c.Assert(err, IsNil)
	c.Assert(shouts, HasLen, 50)
}

func (s *S) TestGetTopTagsUnmarshal(c *C) {
	respString := `<?xml version="1.0" encoding="utf-8"?>
<lfm status="ok"><toptags artist="Radiohead" album="The Bends"><tag><name>albums I own</name><count>100</count><url>http://www.last.fm/tag/albums%20i%20own</url></tag><tag><name>favorite albums</name><count>55</count><url>http://www.last.fm/tag/favorite%20albums</url></tag><tag><name>alternative rock</name><count>53</count><url>http://www.last.fm/tag/alternative%20rock</url></tag><tag><name>radiohead</name><count>45</count><url>http://www.last.fm/tag/radiohead</url></tag><tag><name>rock</name><count>35</count><url>http://www.last.fm/tag/rock</url></tag><tag><name>alternative</name><count>32</count><url>http://www.last.fm/tag/alternative</url></tag><tag><name>90s</name><count>29</count><url>http://www.last.fm/tag/90s</url></tag><tag><name>favourite albums</name><count>17</count><url>http://www.last.fm/tag/favourite%20albums</url></tag><tag><name>1995</name><count>15</count><url>http://www.last.fm/tag/1995</url></tag><tag><name>indie</name><count>14</count><url>http://www.last.fm/tag/indie</url></tag><tag><name>british</name><count>9</count><url>http://www.last.fm/tag/british</url></tag><tag><name>indie rock</name><count>7</count><url>http://www.last.fm/tag/indie%20rock</url></tag><tag><name>britpop</name><count>6</count><url>http://www.last.fm/tag/britpop</url></tag><tag><name>the bends</name><count>5</count><url>http://www.last.fm/tag/the%20bends</url></tag><tag><name>classic albums</name><count>3</count><url>http://www.last.fm/tag/classic%20albums</url></tag><tag><name>Grunge</name><count>3</count><url>http://www.last.fm/tag/grunge</url></tag><tag><name>UK</name><count>3</count><url>http://www.last.fm/tag/uk</url></tag><tag><name>awful</name><count>2</count><url>http://www.last.fm/tag/awful</url></tag><tag><name>experimental</name><count>2</count><url>http://www.last.fm/tag/experimental</url></tag><tag><name>favorite album</name><count>2</count><url>http://www.last.fm/tag/favorite%20album</url></tag><tag><name>1996</name><count>2</count><url>http://www.last.fm/tag/1996</url></tag><tag><name>overrated</name><count>2</count><url>http://www.last.fm/tag/overrated</url></tag><tag><name>Brutal Death Metal</name><count>1</count><url>http://www.last.fm/tag/brutal%20death%20metal</url></tag><tag><name>albums I love</name><count>1</count><url>http://www.last.fm/tag/albums%20i%20love</url></tag><tag><name>brit-rock</name><count>1</count><url>http://www.last.fm/tag/brit-rock</url></tag><tag><name>Radiohead - The Bends</name><count>1</count><url>http://www.last.fm/tag/radiohead%20-%20the%20bends</url></tag><tag><name>own</name><count>1</count><url>http://www.last.fm/tag/own</url></tag><tag><name>cd collection</name><count>1</count><url>http://www.last.fm/tag/cd%20collection</url></tag><tag><name>Masterpiece</name><count>1</count><url>http://www.last.fm/tag/masterpiece</url></tag><tag><name>melancholy</name><count>1</count><url>http://www.last.fm/tag/melancholy</url></tag><tag><name>Awesome</name><count>1</count><url>http://www.last.fm/tag/awesome</url></tag><tag><name>favorites</name><count>1</count><url>http://www.last.fm/tag/favorites</url></tag><tag><name>Favorite</name><count>1</count><url>http://www.last.fm/tag/favorite</url></tag><tag><name>best albums</name><count>1</count><url>http://www.last.fm/tag/best%20albums</url></tag><tag><name>oxford</name><count>1</count><url>http://www.last.fm/tag/oxford</url></tag><tag><name>1001 Albums You Must Hear Before You Die</name><count>1</count><url>http://www.last.fm/tag/1001%20albums%20you%20must%20hear%20before%20you%20die</url></tag><tag><name>electronic</name><count>1</count><url>http://www.last.fm/tag/electronic</url></tag><tag><name>classic</name><count>1</count><url>http://www.last.fm/tag/classic</url></tag><tag><name>albums i dont own yet</name><count>1</count><url>http://www.last.fm/tag/albums%20i%20dont%20own%20yet</url></tag><tag><name>albums</name><count>1</count><url>http://www.last.fm/tag/albums</url></tag><tag><name>Essential Albums</name><count>1</count><url>http://www.last.fm/tag/essential%20albums</url></tag><tag><name>best</name><count>1</count><url>http://www.last.fm/tag/best</url></tag><tag><name>genius</name><count>1</count><url>http://www.last.fm/tag/genius</url></tag><tag><name>thom yorke</name><count>1</count><url>http://www.last.fm/tag/thom%20yorke</url></tag><tag><name>radiohead the bends</name><count>1</count><url>http://www.last.fm/tag/radiohead%20the%20bends</url></tag><tag><name>my albums</name><count>1</count><url>http://www.last.fm/tag/my%20albums</url></tag><tag><name>vinyl</name><count>1</count><url>http://www.last.fm/tag/vinyl</url></tag><tag><name>fav</name><count>1</count><url>http://www.last.fm/tag/fav</url></tag><tag><name>death metal</name><count>1</count><url>http://www.last.fm/tag/death%20metal</url></tag><tag><name>Progressive rock</name><count>1</count><url>http://www.last.fm/tag/progressive%20rock</url></tag><tag><name>no radiohead radio</name><count>1</count><url>http://www.last.fm/tag/no%20radiohead%20radio</url></tag><tag><name>rap</name><count>1</count><url>http://www.last.fm/tag/rap</url></tag><tag><name>brit rock</name><count>0</count><url>http://www.last.fm/tag/brit%20rock</url></tag><tag><name>Altar of the Metal Gods</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods</url></tag><tag><name>underrated</name><count>0</count><url>http://www.last.fm/tag/underrated</url></tag><tag><name>Great album</name><count>0</count><url>http://www.last.fm/tag/great%20album</url></tag><tag><name>the best</name><count>0</count><url>http://www.last.fm/tag/the%20best</url></tag><tag><name>my nineties</name><count>0</count><url>http://www.last.fm/tag/my%20nineties</url></tag><tag><name>arcaders</name><count>0</count><url>http://www.last.fm/tag/arcaders</url></tag><tag><name>mvr rock radio</name><count>0</count><url>http://www.last.fm/tag/mvr%20rock%20radio</url></tag><tag><name>Perfect Albums</name><count>0</count><url>http://www.last.fm/tag/perfect%20albums</url></tag><tag><name>my private work station</name><count>0</count><url>http://www.last.fm/tag/my%20private%20work%20station</url></tag><tag><name>Incredible</name><count>0</count><url>http://www.last.fm/tag/incredible</url></tag><tag><name>male vocalists</name><count>0</count><url>http://www.last.fm/tag/male%20vocalists</url></tag><tag><name>la tag de lemo</name><count>0</count><url>http://www.last.fm/tag/la%20tag%20de%20lemo</url></tag><tag><name>own on vinyl</name><count>0</count><url>http://www.last.fm/tag/own%20on%20vinyl</url></tag><tag><name>john leckie</name><count>0</count><url>http://www.last.fm/tag/john%20leckie</url></tag><tag><name>the greatest albums of all time</name><count>0</count><url>http://www.last.fm/tag/the%20greatest%20albums%20of%20all%20time</url></tag><tag><name>two headed boy</name><count>0</count><url>http://www.last.fm/tag/two%20headed%20boy</url></tag><tag><name>Alternative Pop and Rock</name><count>0</count><url>http://www.last.fm/tag/alternative%20pop%20and%20rock</url></tag><tag><name>classic radiohead</name><count>0</count><url>http://www.last.fm/tag/classic%20radiohead</url></tag><tag><name>desert island discs</name><count>0</count><url>http://www.last.fm/tag/desert%20island%20discs</url></tag><tag><name>my favorite album</name><count>0</count><url>http://www.last.fm/tag/my%20favorite%20album</url></tag><tag><name>fave albums</name><count>0</count><url>http://www.last.fm/tag/fave%20albums</url></tag><tag><name>in my collection</name><count>0</count><url>http://www.last.fm/tag/in%20my%20collection</url></tag><tag><name>top album</name><count>0</count><url>http://www.last.fm/tag/top%20album</url></tag><tag><name>Favourite Albums Of All Time</name><count>0</count><url>http://www.last.fm/tag/favourite%20albums%20of%20all%20time</url></tag><tag><name>albums i own on cd</name><count>0</count><url>http://www.last.fm/tag/albums%20i%20own%20on%20cd</url></tag><tag><name>essentials</name><count>0</count><url>http://www.last.fm/tag/essentials</url></tag><tag><name>5 Stars</name><count>0</count><url>http://www.last.fm/tag/5%20stars</url></tag><tag><name>My favourite albums</name><count>0</count><url>http://www.last.fm/tag/my%20favourite%20albums</url></tag><tag><name>great albums</name><count>0</count><url>http://www.last.fm/tag/great%20albums</url></tag><tag><name>own it</name><count>0</count><url>http://www.last.fm/tag/own%20it</url></tag><tag><name>Awesome stuff</name><count>0</count><url>http://www.last.fm/tag/awesome%20stuff</url></tag><tag><name>alternative pop/rock</name><count>0</count><url>http://www.last.fm/tag/alternative%2Bpop%252Frock</url></tag><tag><name>90s faves</name><count>0</count><url>http://www.last.fm/tag/90s%20faves</url></tag><tag><name>90's</name><count>0</count><url>http://www.last.fm/tag/90%27s</url></tag><tag><name>My Favorite Albums</name><count>0</count><url>http://www.last.fm/tag/my%20favorite%20albums</url></tag><tag><name>Pitchfork Top 100 Albums of the 1990s</name><count>0</count><url>http://www.last.fm/tag/pitchfork%20top%20100%20albums%20of%20the%201990s</url></tag><tag><name>best album ever</name><count>0</count><url>http://www.last.fm/tag/best%20album%20ever</url></tag><tag><name>Pop-Rock</name><count>0</count><url>http://www.last.fm/tag/pop-rock</url></tag><tag><name>Britrock</name><count>0</count><url>http://www.last.fm/tag/britrock</url></tag><tag><name>Altar of the Metal Gods Symphonic Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20symphonic%20metal</url></tag><tag><name>Altar of the Metal Gods Power Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20power%20metal</url></tag><tag><name>Altar of the Metal Gods Ambient Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20ambient%20metal</url></tag><tag><name>Altar of the Metal Gods Black Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20black%20metal</url></tag><tag><name>Altar of the Metal Gods Death Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20death%20metal</url></tag><tag><name>Altar of the Metal Gods Doom Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20doom%20metal</url></tag><tag><name>Altar of the Metal Gods Drone Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20drone%20metal</url></tag><tag><name>Altar of the Metal Gods Epic Metal</name><count>0</count><url>http://www.last.fm/tag/altar%20of%20the%20metal%20gods%20epic%20metal</url></tag></toptags></lfm>`

	tags := []Tag{}
	err := xml.Unmarshal([]byte(respString), &struct {
		Tags *[]Tag `xml:"toptags>tag"`
	}{Tags: &tags})
	c.Assert(err, IsNil)
	c.Assert(tags, HasLen, 100)
	c.Assert(tags[0].Name, Equals, "albums I own")
	c.Assert(tags[2].Count, Equals, 53)
}

func (s *S) TestGetTopTagsE2E(c *C) {
	tags, err := testClient.Album().GetTopTags("Radiohead", "OK Computer", false)
	c.Assert(err, IsNil)
	c.Assert(tags, HasLen, 100)
}

func (s *S) TestSearch(c *C) {
	respString := `<?xml version="1.0" encoding="utf-8"?>
<lfm status="ok"><results xmlns:opensearch="http://a9.com/-/spec/opensearch/1.1/" for="believe"><opensearch:Query role="request" searchTerms="believe" startPage="1"/><opensearch:totalResults>3052</opensearch:totalResults><opensearch:startIndex>0</opensearch:startIndex><opensearch:itemsPerPage>50</opensearch:itemsPerPage><albummatches><album><name>Believe</name><artist>Disturbed</artist><id>1418894</id><url>http://www.last.fm/music/Disturbed/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/53553281.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/53553281.png</image><image size="large">http://userserve-ak.last.fm/serve/126/53553281.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/53553281.png</image><streamable>1</streamable><mbid>3a0d8f14-dcdb-38c9-b273-f2ab536cdf6c</mbid></album><album><name>Make Believe</name><artist>Weezer</artist><id>2025180</id><url>http://www.last.fm/music/Weezer/Make+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/53692665.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/53692665.png</image><image size="large">http://userserve-ak.last.fm/serve/126/53692665.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/53692665.png</image><streamable>1</streamable><mbid>42450da0-67b3-3d26-b3c4-dad46436204e</mbid></album><album><name>Don't Believe the Truth</name><artist>Oasis</artist><id>2024297</id><url>http://www.last.fm/music/Oasis/Don%27t+Believe+the+Truth</url><image size="small">http://userserve-ak.last.fm/serve/34s/53475415.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/53475415.png</image><image size="large">http://userserve-ak.last.fm/serve/126/53475415.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/53475415.png</image><streamable>1</streamable><mbid>3e095ef7-0083-4f97-bc81-0b7fcf2c8507</mbid></album><album><name>If You Can Believe Your Eyes And Ears</name><artist>The Mamas &amp; the Papas</artist><id>2037402</id><url>http://www.last.fm/music/The+Mamas+&amp;+the+Papas/If+You+Can+Believe+Your+Eyes+And+Ears</url><image size="small">http://userserve-ak.last.fm/serve/34s/39951889.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/39951889.png</image><image size="large">http://userserve-ak.last.fm/serve/126/39951889.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/39951889.png</image><streamable>1</streamable><mbid>83696c2a-9457-3096-b8de-0f71a2287e99</mbid></album><album><name>Believe</name><artist>Cher</artist><id>2026126</id><url>http://www.last.fm/music/Cher/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/72903330.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/72903330.png</image><image size="large">http://userserve-ak.last.fm/serve/126/72903330.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/72903330.png</image><streamable>1</streamable><mbid>250e1aa0-fbb9-4f15-8321-3550b6c742ac</mbid></album><album><name>Dream to Make Believe</name><artist>Armor for Sleep</artist><id>2029327</id><url>http://www.last.fm/music/Armor+for+Sleep/Dream+to+Make+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/72892390.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/72892390.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/72892390.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/72892390.jpg</image><streamable>1</streamable><mbid>460b65c5-ac1b-44e1-89da-82a8ebf24d28</mbid></album><album><name>There Is A Hell, Believe Me I've Seen It. There Is A Heaven, Let's Keep It A Secret</name><artist>Bring Me the Horizon</artist><id>242041794</id><url>http://www.last.fm/music/Bring+Me+the+Horizon/There+Is+A+Hell,+Believe+Me+I%27ve+Seen+It.+There+Is+A+Heaven,+Let%27s+Keep+It+A+Secret</url><image size="small">http://userserve-ak.last.fm/serve/34s/52251301.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/52251301.png</image><image size="large">http://userserve-ak.last.fm/serve/126/52251301.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/52251301.png</image><streamable>1</streamable><mbid>50b69889-a425-4e70-941b-7a8aea7f3b1f</mbid></album><album><name>Believe</name><artist>Justin Bieber</artist><id>257522269</id><url>http://www.last.fm/music/Justin+Bieber/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/78991153.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/78991153.png</image><image size="large">http://userserve-ak.last.fm/serve/126/78991153.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/78991153.png</image><streamable>0</streamable><mbid>22ec2223-2454-48f8-8b26-2861d7c92187</mbid></album><album><name>Believe</name><artist>4 Strings</artist><id>2031897</id><url>http://www.last.fm/music/4+Strings/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/71019574.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/71019574.png</image><image size="large">http://userserve-ak.last.fm/serve/126/71019574.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/71019574.png</image><streamable>1</streamable><mbid>1d3332d3-3b23-4f10-b0f1-736ee598370f</mbid></album><album><name>Master of My Make-Believe</name><artist>Santigold</artist><id>295448773</id><url>http://www.last.fm/music/Santigold/Master+of+My+Make-Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/75025430.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/75025430.png</image><image size="large">http://userserve-ak.last.fm/serve/126/75025430.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/75025430.png</image><streamable>0</streamable><mbid>763e2453-5f6a-4d8a-8d8c-c4460853c6bd</mbid></album><album><name>Do you Believe In Magic</name><artist>The Lovin' Spoonful</artist><id>2127956</id><url>http://www.last.fm/music/The+Lovin%27+Spoonful/Do+you+Believe+In+Magic</url><image size="small">http://userserve-ak.last.fm/serve/34s/66926796.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/66926796.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/66926796.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/66926796.jpg</image><streamable>1</streamable><mbid>b01fb088-a9fe-4f12-853e-141981b83715</mbid></album><album><name>Believers Never Die - Greatest Hits</name><artist>Fall Out Boy</artist><id>205357022</id><url>http://www.last.fm/music/Fall+Out+Boy/Believers+Never+Die+-+Greatest+Hits</url><image size="small">http://userserve-ak.last.fm/serve/34s/37179809.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/37179809.png</image><image size="large">http://userserve-ak.last.fm/serve/126/37179809.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/37179809.png</image><streamable>1</streamable><mbid>fa345686-b9cf-47d4-9862-e37e9199c4e5</mbid></album><album><name>Shallow Believer</name><artist>The Used</artist><id>3727364</id><url>http://www.last.fm/music/The+Used/Shallow+Believer</url><image size="small">http://userserve-ak.last.fm/serve/34s/42879765.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/42879765.png</image><image size="large">http://userserve-ak.last.fm/serve/126/42879765.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/42879765.png</image><streamable>0</streamable><mbid>7e958e85-9567-462b-a627-2b826cb12e83</mbid></album><album><name>The Believer</name><artist>Rhett Miller</artist><id>2491586</id><url>http://www.last.fm/music/Rhett+Miller/The+Believer</url><image size="small">http://userserve-ak.last.fm/serve/34s/67280574.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/67280574.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/67280574.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/67280574.jpg</image><streamable>0</streamable><mbid>17ccd7cb-aa2f-4d73-8db2-1166f986f0ac</mbid></album><album><name>Believe (bonus disc: Australian Tour)</name><artist>Disturbed</artist><id>2272524</id><url>http://www.last.fm/music/Disturbed/Believe+(bonus+disc:+Australian+Tour)</url><image size="small">http://images.amazon.com/images/P/B000069KN8.01.MZZZZZZZ.jpg</image><image size="medium">http://images.amazon.com/images/P/B000069KN8.01.MZZZZZZZ.jpg</image><image size="large">http://images.amazon.com/images/P/B000069KN8.01.MZZZZZZZ.jpg</image><image size="extralarge">http://images.amazon.com/images/P/B000069KN8.01.MZZZZZZZ.jpg</image><streamable>0</streamable><mbid>1d509ce7-1680-4df2-bb24-f534d164328b</mbid></album><album><name>We All Need A Reason To Believe</name><artist>Valencia</artist><id>3909169</id><url>http://www.last.fm/music/Valencia/We+All+Need+A+Reason+To+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/14937037.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/14937037.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/14937037.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/14937037.jpg</image><streamable>1</streamable><mbid>04d2ed39-4e95-44a4-83e1-86410297bd0f</mbid></album><album><name>Reason To Believe</name><artist>Pennywise</artist><id>3766885</id><url>http://www.last.fm/music/Pennywise/Reason+To+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/82060183.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/82060183.png</image><image size="large">http://userserve-ak.last.fm/serve/126/82060183.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/82060183.png</image><streamable>0</streamable><mbid>441659e9-eaef-431e-9f0c-6bec526119bf</mbid></album><album><name>heart to believe</name><artist>Itchy Poopzkid</artist><id>3076526</id><url>http://www.last.fm/music/Itchy+Poopzkid/heart+to+believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/75385918.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/75385918.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/75385918.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/75385918.jpg</image><streamable>0</streamable><mbid>e8f95af3-78c6-4910-94dd-9fd0998ec5a8</mbid></album><album><name>Believe</name><artist>Orianthi</artist><id>206417046</id><url>http://www.last.fm/music/Orianthi/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/42039321.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/42039321.png</image><image size="large">http://userserve-ak.last.fm/serve/126/42039321.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/42039321.png</image><streamable>1</streamable><mbid>855ba240-d62c-4742-80b3-306ebecd0de1</mbid></album><album><name>Reason to Believe (The Best Of)</name><artist>Tim Hardin</artist><id>2389266</id><url>http://www.last.fm/music/Tim+Hardin/Reason+to+Believe+(The+Best+Of)</url><image size="small">http://images.amazon.com/images/P/B000001FNP.01.MZZZZZZZ.jpg</image><image size="medium">http://images.amazon.com/images/P/B000001FNP.01.MZZZZZZZ.jpg</image><image size="large">http://images.amazon.com/images/P/B000001FNP.01.MZZZZZZZ.jpg</image><image size="extralarge">http://images.amazon.com/images/P/B000001FNP.01.MZZZZZZZ.jpg</image><streamable>1</streamable><mbid>3528a980-171b-452d-8afe-fe7f0c923c21</mbid></album><album><name>I Wouldn't Believe Your Radio</name><artist>Stereophonics</artist><id>2304877</id><url>http://www.last.fm/music/Stereophonics/I+Wouldn%27t+Believe+Your+Radio</url><image size="small">http://userserve-ak.last.fm/serve/34s/82854061.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/82854061.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/82854061.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/82854061.jpg</image><streamable>1</streamable><mbid>07c8f6e9-dda1-4f1e-b668-70df6d999b62</mbid></album><album><name>Do You Believe Me Now</name><artist>Jimmy Wayne</artist><id>3879456</id><url>http://www.last.fm/music/Jimmy+Wayne/Do+You+Believe+Me+Now</url><image size="small">http://userserve-ak.last.fm/serve/34s/80671063.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/80671063.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/80671063.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/80671063.jpg</image><streamable>1</streamable><mbid>835c4ef6-acbf-4bee-88d6-ddf1c6011321</mbid></album><album><name>Believe in Nothing</name><artist>Paradise Lost</artist><id>2194165</id><url>http://www.last.fm/music/Paradise+Lost/Believe+in+Nothing</url><image size="small">http://userserve-ak.last.fm/serve/34s/28230145.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/28230145.png</image><image size="large">http://userserve-ak.last.fm/serve/126/28230145.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/28230145.png</image><streamable>1</streamable><mbid>058b38c2-710b-414c-9991-466a69744fa0</mbid></album><album><name>Believe</name><artist>Crematory</artist><id>2370614</id><url>http://www.last.fm/music/Crematory/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/56976413.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/56976413.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/56976413.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/56976413.jpg</image><streamable>0</streamable><mbid>b2a48b87-9371-4168-807a-255f69dc5207</mbid></album><album><name>I Believe In You. Your Magic Is Real</name><artist>Yacht</artist><id>3815627</id><url>http://www.last.fm/music/Yacht/I+Believe+In+You.+Your+Magic+Is+Real</url><image size="small">http://userserve-ak.last.fm/serve/34s/61280555.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/61280555.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/61280555.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/61280555.jpg</image><streamable>1</streamable><mbid>109268fb-4ea6-4002-9a5f-5c6d6e2ec499</mbid></album><album><name>Land Of Make Believe</name><artist>Kidz in the Hall</artist><id>79720115</id><url>http://www.last.fm/music/Kidz+in+the+Hall/Land+Of+Make+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/73438326.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/73438326.png</image><image size="large">http://userserve-ak.last.fm/serve/126/73438326.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/73438326.png</image><streamable>0</streamable><mbid>89aa2808-3da5-46c0-bfd6-d1ecd48b7527</mbid></album><album><name>I Believe in a Thing Called Love</name><artist>The Darkness</artist><id>13492</id><url>http://www.last.fm/music/The+Darkness/I+Believe+in+a+Thing+Called+Love</url><image size="small">http://userserve-ak.last.fm/serve/34s/8598177.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/8598177.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/8598177.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/8598177.jpg</image><streamable>0</streamable><mbid>4f76462d-d511-4210-ac8c-2817f95b7a4d</mbid></album><album><name>Paper Ships Under A Burning Bridge</name><artist>Last of the Believers</artist><id>3567586</id><url>http://www.last.fm/music/Last+of+the+Believers/Paper+Ships+Under+A+Burning+Bridge</url><image size="small">http://userserve-ak.last.fm/serve/34s/21614503.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/21614503.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/21614503.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/21614503.jpg</image><streamable>1</streamable><mbid>da83c225-0b0b-4413-af79-2dd857602053</mbid></album><album><name>20.3003-HI (1of2) - Believe in Miracles</name><artist>Fats Waller</artist><id>2358868</id><url>http://www.last.fm/music/Fats+Waller/20.3003-HI+(1of2)+-+Believe+in+Miracles</url><image size="small">http://userserve-ak.last.fm/serve/34s/11930617.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/11930617.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/11930617.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/11930617.jpg</image><streamable>1</streamable><mbid/></album><album><name>I Believe</name><artist>Lange</artist><id>2413318</id><url>http://www.last.fm/music/Lange/I+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/8785537.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/8785537.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/8785537.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/8785537.jpg</image><streamable>0</streamable><mbid/></album><album><name>Do You Believe in Gosh?</name><artist>Mitch Hedberg</artist><id>5507670</id><url>http://www.last.fm/music/Mitch+Hedberg/Do+You+Believe+in+Gosh%3F</url><image size="small">http://userserve-ak.last.fm/serve/34s/22876177.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/22876177.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/22876177.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/22876177.jpg</image><streamable>0</streamable><mbid>06022c49-c941-472e-9b86-9c11aa250bf9</mbid></album><album><name>Believe</name><artist>Morgan Page</artist><id>67008529</id><url>http://www.last.fm/music/Morgan+Page/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/53278461.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/53278461.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/53278461.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/53278461.jpg</image><streamable>1</streamable><mbid>7dfec6a9-e9e6-4859-aac1-aae576b93023</mbid></album><album><name>Believe (disc 2)</name><artist>Airwave</artist><id>2271619</id><url>http://www.last.fm/music/Airwave/Believe+(disc+2)</url><image size="small"/><image size="medium"/><image size="large"/><image size="extralarge"/><streamable>1</streamable><mbid/></album><album><name>Believes In Patterns</name><artist>I Would Set Myself on Fire for You</artist><id>3264296</id><url>http://www.last.fm/music/I+Would+Set+Myself+on+Fire+for+You/Believes+In+Patterns</url><image size="small">http://userserve-ak.last.fm/serve/34s/48846263.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/48846263.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/48846263.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/48846263.jpg</image><streamable>1</streamable><mbid>1863b59b-40a7-4df8-b630-48767ebc2b1d</mbid></album><album><name>Believe</name><artist>Yolanda Adams</artist><id>2084720</id><url>http://www.last.fm/music/Yolanda+Adams/Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/62642527.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/62642527.png</image><image size="large">http://userserve-ak.last.fm/serve/126/62642527.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/62642527.png</image><streamable>0</streamable><mbid>1eca1286-766a-4675-8623-16a55b13b9a4</mbid></album><album><name>Believe (Deluxe Edition)</name><artist>Justin Bieber</artist><id>304082338</id><url>http://www.last.fm/music/Justin+Bieber/Believe+(Deluxe+Edition)</url><image size="small">http://userserve-ak.last.fm/serve/34s/80121429.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/80121429.png</image><image size="large">http://userserve-ak.last.fm/serve/126/80121429.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/80121429.png</image><streamable>0</streamable><mbid>0b782c49-b933-4478-b274-b0e7bf1cc40c</mbid></album><album><name>This Is For The White In Your Eyes</name><artist>Choir of Young Believers</artist><id>3943261</id><url>http://www.last.fm/music/Choir+of+Young+Believers/This+Is+For+The+White+In+Your+Eyes</url><image size="small">http://userserve-ak.last.fm/serve/34s/60677161.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/60677161.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/60677161.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/60677161.jpg</image><streamable>1</streamable><mbid>648f9daf-6f6e-37d7-baa7-48e60d2cb23e</mbid></album><album><name>I Will Believe It</name><artist>Siria</artist><id>3360193</id><url>http://www.last.fm/music/Siria/I+Will+Believe+It</url><image size="small">http://userserve-ak.last.fm/serve/34s/19478329.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/19478329.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/19478329.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/19478329.jpg</image><streamable>1</streamable><mbid>234048a4-4d69-4c55-953e-6e6a1b076d4a</mbid></album><album><name>Believers</name><artist>A.A. Bondy</artist><id>276703862</id><url>http://www.last.fm/music/A.A.+Bondy/Believers</url><image size="small">http://userserve-ak.last.fm/serve/34s/67057626.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/67057626.png</image><image size="large">http://userserve-ak.last.fm/serve/126/67057626.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/67057626.png</image><streamable>0</streamable><mbid>76d9a239-eea3-4bfe-b122-1412d55d59a2</mbid></album><album><name>Do you Believe in Westworld</name><artist>WestBam</artist><id>2393387</id><url>http://www.last.fm/music/WestBam/Do+you+Believe+in+Westworld</url><image size="small">http://userserve-ak.last.fm/serve/34s/5119724.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/5119724.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/5119724.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/5119724.jpg</image><streamable>0</streamable><mbid/></album><album><name>When You Believe</name><artist>Leon Jackson</artist><id>3672492</id><url>http://www.last.fm/music/Leon+Jackson/When+You+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/32249771.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/32249771.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/32249771.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/32249771.jpg</image><streamable>1</streamable><mbid>719431d9-572d-460e-9970-448aed78d1bb</mbid></album><album><name>Someone's Gonna Get Their Head to Believe in Something</name><artist>Various Artists</artist><id>2380714</id><url>http://www.last.fm/music/Various+Artists/Someone%27s+Gonna+Get+Their+Head+to+Believe+in+Something</url><image size="small">http://userserve-ak.last.fm/serve/34s/33081629.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/33081629.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/33081629.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/33081629.jpg</image><streamable>1</streamable><mbid>0be5aaf9-76fb-41ee-a96d-c15b34336ed9</mbid></album><album><name>I Believe You Liar</name><artist>Washington</artist><id>233882131</id><url>http://www.last.fm/music/Washington/I+Believe+You+Liar</url><image size="small">http://userserve-ak.last.fm/serve/34s/53564013.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/53564013.png</image><image size="large">http://userserve-ak.last.fm/serve/126/53564013.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/53564013.png</image><streamable>1</streamable><mbid>204d0ea8-d37a-4c8d-8fda-d9e99b22c247</mbid></album><album><name>I Believe In You. Your Magic Is Real.</name><artist>Yacht</artist><id>3923485</id><url>http://www.last.fm/music/Yacht/I+Believe+In+You.+Your+Magic+Is+Real.</url><image size="small">http://userserve-ak.last.fm/serve/34s/64744509.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/64744509.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/64744509.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/64744509.jpg</image><streamable>1</streamable><mbid/></album><album><name>I Believe</name><artist>Frankie Laine</artist><id>2295653</id><url>http://www.last.fm/music/Frankie+Laine/I+Believe</url><image size="small">http://userserve-ak.last.fm/serve/34s/75362862.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/75362862.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/75362862.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/75362862.jpg</image><streamable>1</streamable><mbid/></album><album><name>Believe What We Tell You</name><artist>The Sleeping</artist><id>2211286</id><url>http://www.last.fm/music/The+Sleeping/Believe+What+We+Tell+You</url><image size="small">http://userserve-ak.last.fm/serve/34s/82157675.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/82157675.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/82157675.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/82157675.jpg</image><streamable>1</streamable><mbid>7a372e26-28fe-4dd9-8aee-58386c09898d</mbid></album><album><name>Early Believers</name><artist>Kero One</artist><id>50137255</id><url>http://www.last.fm/music/Kero+One/Early+Believers</url><image size="small">http://userserve-ak.last.fm/serve/34s/33112499.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/33112499.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/33112499.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/33112499.jpg</image><streamable>1</streamable><mbid>0cf37719-4a34-4665-bfa5-9042de96f7f2</mbid></album><album><name>You Must Believe in Spring</name><artist>Bill Evans</artist><id>2385348</id><url>http://www.last.fm/music/Bill+Evans/You+Must+Believe+in+Spring</url><image size="small">http://userserve-ak.last.fm/serve/34s/77905758.png</image><image size="medium">http://userserve-ak.last.fm/serve/64s/77905758.png</image><image size="large">http://userserve-ak.last.fm/serve/126/77905758.png</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/77905758.png</image><streamable>0</streamable><mbid>4a3df354-08da-4b97-971a-757ad6c3a3f3</mbid></album><album><name>Shock of Being</name><artist>Make Believe</artist><id>2287279</id><url>http://www.last.fm/music/Make+Believe/Shock+of+Being</url><image size="small">http://userserve-ak.last.fm/serve/34s/33120171.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/33120171.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/33120171.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/33120171.jpg</image><streamable>1</streamable><mbid>b62d4552-8283-40b6-97c3-939aac9f79d9</mbid></album><album><name>Of Course</name><artist>Make Believe</artist><id>3295465</id><url>http://www.last.fm/music/Make+Believe/Of+Course</url><image size="small">http://userserve-ak.last.fm/serve/34s/42669581.jpg</image><image size="medium">http://userserve-ak.last.fm/serve/64s/42669581.jpg</image><image size="large">http://userserve-ak.last.fm/serve/126/42669581.jpg</image><image size="extralarge">http://userserve-ak.last.fm/serve/300x300/42669581.jpg</image><streamable>1</streamable><mbid>d309fa4f-a6b8-40db-ad52-f03c6d615301</mbid></album></albummatches></results></lfm>`

	searchResults := AlbumSearchResults{}
	err := xml.Unmarshal([]byte(respString), &struct {
		Results *AlbumSearchResults `xml:"results"`
	}{Results: &searchResults})
	c.Assert(err, IsNil)
	c.Assert(searchResults.Albums, HasLen, 50)
	c.Assert(searchResults.Albums[2].Name, Equals, "Don't Believe the Truth")
	c.Assert(searchResults.TotalResults, Equals, 3052)
}

func (s *S) TestSearchE2E(c *C) {
	results, err := testClient.Album().Search("OK Computer", 1, 30)
	c.Assert(err, IsNil)
	c.Assert(results.Albums[0].Artist, Equals, "Radiohead")
}
